<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <title>页面内搜索示例</title>
    <style>
        /* 搜索框样式 */
        
        .search-box {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        .search-box input {
            padding: 4px;
            margin-right: 6px;
            border: 1px solid #999;
            border-radius: 3px;
        }
        
        .search-box button {
            padding: 4px 8px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .search-box button:hover {
            background: #0056b3;
        }
        /* 高亮样式 */
        
        .highlight {
            background-color: yellow;
            color: black;
        }
    </style>
</head>

<body>

    <!-- 搜索框 -->
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="输入关键词..." />
        <button onclick="searchOnPage()">搜索</button>
    </div>

    <!-- 页面内容（示例） -->
    <h1>欢迎来到我的网页</h1>
    <p>这是一个关于前端开发的示例页面。</p>
    <p>你可以在这里搜索任意关键词，比如“JavaScript”、“HTML”或“搜索”。</p>
    <p>JavaScript 是一种强大的编程语言，常用于网页交互。</p>
    <p>HTML 是构建网页结构的基础。</p>
    <p>如果你喜欢这个功能，请继续阅读更多内容！</p>
    <p>再次提到：JavaScript 让网页动起来。</p>

    <script>
        // 清除之前的高亮
        function clearHighlights() {
            const highlights = document.querySelectorAll('.highlight');
            highlights.forEach(node => {
                const parent = node.parentNode;
                while (node.firstChild) {
                    parent.insertBefore(node.firstChild, node);
                }
                parent.removeChild(node);
            });
        }

        // 在页面中搜索关键词
        function searchOnPage() {
            const keyword = document.getElementById('searchInput').value.trim();
            if (!keyword) return;

            clearHighlights();

            const bodyText = document.body.innerText || document.body.textContent;
            if (!bodyText.includes(keyword)) {
                alert('未找到关键词：“' + keyword + '”');
                return;
            }

            // 创建一个临时 span 来高亮匹配项（简单版）
            const walker = document.createTreeWalker(
                document.body,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );

            let node;
            let found = false;
            const range = document.createRange();
            const sel = window.getSelection();

            while (node = walker.nextNode()) {
                const index = node.nodeValue.toLowerCase().indexOf(keyword.toLowerCase());
                if (index !== -1) {
                    // 创建高亮元素
                    const span = document.createElement('span');
                    span.className = 'highlight';
                    const textBefore = node.nodeValue.substring(0, index);
                    const textMatch = node.nodeValue.substring(index, index + keyword.length);
                    const textAfter = node.nodeValue.substring(index + keyword.length);

                    span.textContent = textMatch;
                    node.nodeValue = textBefore;
                    const afterNode = document.createTextNode(textAfter);
                    node.parentNode.insertBefore(afterNode, node.nextSibling);
                    node.parentNode.insertBefore(span, afterNode);

                    // 滚动到该位置
                    span.scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });
                    range.selectNodeContents(span);
                    sel.removeAllRanges();
                    sel.addRange(range);

                    found = true;
                    break; // 只跳转到第一个匹配项
                }
            }

            if (!found) {
                alert('未找到关键词：“' + keyword + '”');
            }
        }

        // 支持回车搜索
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchOnPage();
            }
        });
    </script>

</body>

</html>